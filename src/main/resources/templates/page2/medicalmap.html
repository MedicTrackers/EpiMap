<!DOCTYPE html>
<html layout:decorate="~{layout/mainLayout}">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Insert title here</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://code.jquery.com/jquery-3.7.1.js"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.8.0/font/bootstrap-icons.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/meyer-reset/2.0/reset.min.css">
    <!-- map api ê°ì ë°œê¸‰ë°›ì€ Client ID ê°’ ë„£ê¸° -->
    <script type="text/javascript" src="https://openapi.map.naver.com/openapi/v3/maps.js?ncpClientId=yg9kt0fwzl"></script>
</head>
<style>
    .box {
        width: 412px;
        height: 917px;
    }

    .box .group {
        position: fixed;
        width: 412px;
        height: 917px;
        top: 0;
        left: 0;
        background-image: url(https://c.animaapp.com/PzzeW1l1/img/app@2x.png);
        background-size: cover;
        background-position: 50% 50%;
    }



    * {
        -webkit-font-smoothing: antialiased;
        box-sizing: border-box;
    }
    html,
    body {
        margin: 0px;
        height: 100%;
    }
    /* a blue color as a generic focus style */
    button:focus-visible {
        outline: 2px solid #4a90e2 !important;
        outline: -webkit-focus-ring-color auto 5px !important;
    }
    a {
        text-decoration: none;
    }

</style>
<body>
<div layout:fragment="content">

    <!--map ì¶œë ¥ë¶€ë¶„-->
    <div id="map" style="width:100%;height:400px;"></div>

    <!--í”¼ê·¸ë§ˆ í˜¸ì¶œ-->
    <div class="box"><div class="group"></div></div>

    <!--API ê²°ê³¼-->
    <div id="result"></div>

    <!--map ë§ˆì»¤ ìŠ¤í¬ë¦½íŠ¸-->
    <script>
        /*let stage1="ì„œìš¸íŠ¹ë³„ì‹œ";
        let stage2="ê°•ë‚¨êµ¬";*/
        let lat;
        let lon;

        medical();

        navigator.geolocation.getCurrentPosition((position) => {
            lat = position.coords.latitude;
            lon = position.coords.longitude;

            const currentLocation = new naver.maps.LatLng(lat, lon);

            const mapOptions = {
                center: currentLocation,
                zoom: 15,
                zoomControl: true,
                zoomControlOptions: {
                    style: naver.maps.ZoomControlStyle.SMALL,
                    position: naver.maps.Position.TOP_RIGHT
                }
            };

            const map = new naver.maps.Map('map', mapOptions);

            // âœ… í˜„ì¬ ìœ„ì¹˜ì— ë§ˆì»¤ ì°ê¸°
            const marker = new naver.maps.Marker({
                position: currentLocation,
                map: map,
                title: 'ë‚´ ìœ„ì¹˜'
            });

            // âœ… í´ë¦­í•˜ë©´ ì •ë³´ì°½ë„ ëœ¨ê²Œ (ì„ íƒ)
            const infoWindow = new naver.maps.InfoWindow({
                content: '<div style="padding:5px;">ğŸ“ í˜„ì¬ ìœ„ì¹˜ì…ë‹ˆë‹¤.</div>'
            });

            naver.maps.Event.addListener(marker, "click", function () {
                infoWindow.open(map, marker);
            });

        }, (error) => {
            alert("ìœ„ì¹˜ ì •ë³´ë¥¼ ê°€ì ¸ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤. ë¸Œë¼ìš°ì € ìœ„ì¹˜ ê¶Œí•œì„ í™•ì¸í•´ì£¼ì„¸ìš”.");
            console.error(error);
        });

        function medical() {
            $.ajax({
                url: 'http://apis.data.go.kr/B552657/ErmctInfoInqireService/getEmrrmRltmUsefulSckbdInfoInqire',
                type: 'GET',
                data: {
                    serviceKey: '17Ds6cxIqo9+znsM81nIgrGHeWGzUlZBHQ9s9GSWEFqc1McvZaH2ovzWYKxVdi8AopGjXaYCZWcLCX6VcqWd/Q==',  // API í‚¤ë¥¼ ì—¬ê¸°ì— ì…ë ¥í•˜ì„¸ìš”.
                    WGS84_Lon: lon,
                    WGS84_LAT: lat,
                    pageNo: 1,
                    numOfRows: 10
                },
                dataType: 'xml',  // XML ë°ì´í„° í˜•ì‹ìœ¼ë¡œ ë°˜í™˜ë°›ê¸°
                success: function(response) {
                    // XML ë°ì´í„°ë¥¼ JSONìœ¼ë¡œ ë³€í™˜
                    var jsonResponse = xmlToJson(response);
                    console.log(jsonResponse);

                    var items = jsonResponse.response.body.items.item;
                    console.log(items);

                    // í™”ë©´ì— ì¶œë ¥
                    //$('#result').html(JSON.stringify(items, null, 2));
                    $.each(items, function(idx, info) {
                        console.log(info);
                        $("#result").append(`${info.dutyName['#text']}`);

                    });
                },
                error: function(xhr, status, error) {
                    console.error("API í˜¸ì¶œ ì˜¤ë¥˜: " + status + ", " + error);
                }
            });
        }


        // XMLì„ JSONìœ¼ë¡œ ë³€í™˜í•˜ëŠ” í•¨ìˆ˜
        function xmlToJson(xml) {
            var obj = {};
            if (xml.nodeType == 1) { // element
                if (xml.attributes.length > 0) {
                    obj["@attributes"] = {};
                    for (var j = 0; j < xml.attributes.length; j++) {
                        var attribute = xml.attributes.item(j);
                        obj["@attributes"][attribute.nodeName] = attribute.nodeValue;
                    }
                }
            } else if (xml.nodeType == 3) { // text
                obj = xml.nodeValue;
            }

            if (xml.hasChildNodes()) {
                for (var i = 0; i < xml.childNodes.length; i++) {
                    var item = xml.childNodes.item(i);
                    var nodeName = item.nodeName;
                    if (typeof obj[nodeName] == "undefined") {
                        obj[nodeName] = xmlToJson(item);
                    } else {
                        if (typeof obj[nodeName].push == "undefined") {
                            var old = obj[nodeName];
                            obj[nodeName] = [];
                            obj[nodeName].push(old);
                        }
                        obj[nodeName].push(xmlToJson(item));
                    }
                }
            }
            return obj;
        }
    </script>
</div>

</body>
</html>